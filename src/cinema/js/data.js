const data = [
	{
		id: 1,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 0 },
			{ id: 5, state: 0, price: 0 },
			{ id: 6, state: 0, price: 0 },
			{ id: 7, state: 0, price: 0 },
			{ id: 8, state: 0, price: 0 }
		]
	},
	{
		id: 2,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 0 },
			{ id: 5, state: 0, price: 0 },
			{ id: 6, state: 0, price: 0 },
			{ id: 7, state: 0, price: 0 },
			{ id: 8, state: 0, price: 0 },
			{ id: 9, state: 0, price: 0 },
			{ id: 10, state: 0, price: 0 },
			{ id: 11, state: 0, price: 0 },
			{ id: 12, state: 0, price: 0 }
		]
	},
	{
		id: 3,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 0 },
			{ id: 5, state: 0, price: 0 },
			{ id: 6, state: 0, price: 0 },
			{ id: 7, state: 0, price: 0 },
			{ id: 8, state: 0, price: 0 },
			{ id: 9, state: 0, price: 0 },
			{ id: 10, state: 0, price: 0 },
			{ id: 11, state: 0, price: 0 },
			{ id: 12, state: 0, price: 0 },
			{ id: 13, state: 0, price: 0 },
			{ id: 14, state: 0, price: 0 },
			{ id: 15, state: 0, price: 0 },
			{ id: 16, state: 0, price: 0 }
		]
	},
	{
		id: 4,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 0 },
			{ id: 5, state: 0, price: 0 },
			{ id: 6, state: 0, price: 0 },
			{ id: 7, state: 0, price: 0 },
			{ id: 8, state: 0, price: 0 },
			{ id: 9, state: 0, price: 0 },
			{ id: 10, state: 0, price: 0 },
			{ id: 11, state: 0, price: 0 },
			{ id: 12, state: 0, price: 0 },
			{ id: 13, state: 0, price: 0 },
			{ id: 14, state: 0, price: 0 },
			{ id: 15, state: 0, price: 0 },
			{ id: 16, state: 0, price: 0 }
		]
	},
	{
		id: 5,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 0 },
			{ id: 5, state: 0, price: 0 },
			{ id: 6, state: 0, price: 0 },
			{ id: 7, state: 0, price: 0 },
			{ id: 8, state: 0, price: 0 },
			{ id: 9, state: 0, price: 0 },
			{ id: 10, state: 0, price: 0 },
			{ id: 11, state: 0, price: 0 },
			{ id: 12, state: 0, price: 0 },
			{ id: 13, state: 0, price: 0 },
			{ id: 14, state: 0, price: 0 },
			{ id: 15, state: 0, price: 0 },
			{ id: 16, state: 0, price: 0 }
		]
	},
	{
		id: 6,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 0 },
			{ id: 5, state: 0, price: 0 },
			{ id: 6, state: 0, price: 0 },
			{ id: 7, state: 0, price: 0 },
			{ id: 8, state: 0, price: 0 },
			{ id: 9, state: 0, price: 0 },
			{ id: 10, state: 0, price: 0 },
			{ id: 11, state: 0, price: 0 },
			{ id: 12, state: 0, price: 0 },
			{ id: 13, state: 0, price: 0 },
			{ id: 14, state: 0, price: 0 },
			{ id: 15, state: 0, price: 0 },
			{ id: 16, state: 0, price: 0 }
		]
	},
	{
		id: 7,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 0 },
			{ id: 5, state: 0, price: 0 },
			{ id: 6, state: 0, price: 0 },
			{ id: 7, state: 0, price: 0 },
			{ id: 8, state: 0, price: 0 },
			{ id: 9, state: 0, price: 0 },
			{ id: 10, state: 0, price: 0 },
			{ id: 11, state: 0, price: 0 },
			{ id: 12, state: 0, price: 0 },
			{ id: 13, state: 0, price: 0 },
			{ id: 14, state: 0, price: 0 },
			{ id: 15, state: 0, price: 0 },
			{ id: 16, state: 0, price: 0 }
		]
	},
	{
		id: 8,
		chairs: [
			{ id: 1, state: 0, price: 0 },
			{ id: 2, state: 0, price: 0 },
			{ id: 3, state: 0, price: 0 },
			{ id: 4, state: 0, price: 1 },
			{ id: 5, state: 0, price: 1 },
			{ id: 6, state: 0, price: 1 },
			{ id: 7, state: 0, price: 1 },
			{ id: 8, state: 0, price: 1 },
			{ id: 9, state: 0, price: 0 },
			{ id: 10, state: 0, price: 0 },
			{ id: 11, state: 0, price: 0 },
			{ id: 12, state: 0, price: 0 },
			{ id: 13, state: 0, price: 0 },
			{ id: 14, state: 0, price: 0 },
			{ id: 15, state: 0, price: 0 },
			{ id: 16, state: 0, price: 0 }
		]
	}
];

const Cinema = {
	places: [],
	callbacks: [],
	maxCountPlaces: 5,
	count: 0,

	fill(places = []) {
		this.places = places.map(row => ({
			id: row.id || 0,
			chairs: row.chairs.map(chair => ({
				id: chair.id || 0,
				state: chair.state | 0,
				price: chair.price | 0
			}))
		}));
	},

	subscribe(action, callback) {
		this.callbacks.push({ action, callback });
	},

	event(action) {
		const callbacks = this.callbacks.forEach((event) => {
			if (event.action === action)
				event.callback();
		});
	},

	changeState(place = {}, state = 0, callback) {
		if (this.count < this.maxCountPlaces || state === 0) {				//counting selected places
			const { rowId, chairId } = place;
			if (rowId === undefined || chairId === undefined)
				return false;

			this.places = this.places.map((row) => {
				if (row.id !== rowId)
					return row;

				const chairs = row.chairs.map((chair) => {
					if (chair.id !== chairId)
						return chair;
					if (state === 1) this.count += 1;   //counting selected places
					else this.count -= 1;
					return { ...chair, state };
				});

				return { ...row, chairs };
			});

			if (typeof callback === 'function')
				callback(this.places);

			this.event('onchange');
		}			//counting selected places
	},

	isMaxPlaces() {
		return this.count === this.maxCountPlaces;
	},

	clearAll(state) {
		this.places = this.places.map((row) => {
			const chairs = row.chairs.map((chair) => {
				return { ...chair, state };
			});

			return { ...row, chairs };
		});

		this.count = 0;
		this.event('onchange');
	},

	getRows() {
		const obj = this.places.map((row) => {
			return row.id;
		});
		obj.reverse();
		return (obj);
	}
};

Cinema.fill(data);

export default Cinema;
